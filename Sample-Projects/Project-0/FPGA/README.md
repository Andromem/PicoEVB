# Vivado Project

### Project / upgrade info
Controlled files:

- project.tcl: This was originally generated by Vivado, but it has some "custom" changes. So it needs to be hand maintained.
- project_bd.tcl: This is simply saved from the block diagram (```write_bd_tcl -force project_bd.tcl```)
 
Since the project_bd.tcl requires Vivado 2017.3 (exactly), if you want to upgrade to a new version you need to do something like:

- Use old version to open and build project
- Close old version of vivdao
- Open built project in new version of Vivado (directly, not using *.tcl file)
- Upgrade all the IP to latest version of Vivado
- Update block diagram TCL script via ```write_bd_tcl``` from new version of Vivado

### Bitstream Generation
Run through synthesis, implementation and bitstream generation steps in Vivado after creating the project
using TCL script.

### PROM file for onboard flash
Once the bitstream is generated, in the Vivado TCL command prompt, from the Vivado/nanoevb project directory run the following command:

	write_cfgmem -force -format mcs -size 4 -interface SPIx4 \
	-loadbit {up 0x00000000 "./nanoevb/nanoevb.runs/impl_1/project_bd_wrapper.bit" } \
	-file "../mcs/proj0.mcs"


### Programming onboard flash

First, make sure xvcd cable driver is running. Build the xvcd project, then run
`sudo ./xvcd -p 2542 -s i:0x0403:0x6015:0`

Then from vivado, run the following commands to connect to the xvcd driver:
`open_hw; connect_hw_server; open_hw_target -xvc_url localhost:2542`

At this point you should see the FPGA, and can use the dashboard to add monitors, if you like.
If you'd like to program the flash with the bitstream, you can run the following in Vivado
`source ../tcl/prog-flash.tcl`









